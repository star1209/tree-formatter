{"version":3,"file":"index.esm.js","sources":["../../src/plugins/index.ts"],"sourcesContent":["import { TreePlugin, NodeContext } from '../core/types';\n\n/**\n * 插件管理器\n */\nexport class PluginManager<T = any> {\n  private plugins: Map<string, TreePlugin<T>> = new Map();\n  \n  /**\n   * 注册插件\n   */\n  register(plugin: TreePlugin<T>): void {\n    if (this.plugins.has(plugin.name)) {\n      console.warn(`插件 \"${plugin.name}\" 已存在，将被覆盖`);\n    }\n    this.plugins.set(plugin.name, plugin);\n  }\n  \n  /**\n   * 取消注册插件\n   */\n  unregister(pluginName: string): boolean {\n    return this.plugins.delete(pluginName);\n  }\n  \n  /**\n   * 获取插件\n   */\n  getPlugin(pluginName: string): TreePlugin<T> | undefined {\n    return this.plugins.get(pluginName);\n  }\n  \n  /**\n   * 获取所有插件\n   */\n  getAllPlugins(): TreePlugin<T>[] {\n    return Array.from(this.plugins.values())\n      .sort((a, b) => (a.priority || 100) - (b.priority || 100));\n  }\n  \n  /**\n   * 应用节点创建钩子\n   */\n  applyNodeCreated(node: T, context: NodeContext): T {\n    let result = node;\n    \n    for (const plugin of this.getAllPlugins()) {\n      if (plugin.onNodeCreated) {\n        plugin.onNodeCreated(result, context);\n      }\n    }\n    \n    return result;\n  }\n  \n  /**\n   * 应用节点链接钩子\n   */\n  applyNodeLinked(parent: T, child: T, context: NodeContext): boolean {\n    let allowLink = true;\n    \n    for (const plugin of this.getAllPlugins()) {\n      if (plugin.onNodeLinked) {\n        const result = plugin.onNodeLinked(parent, child, context);\n        if (result === false) {\n          allowLink = false;\n          break;\n        }\n      }\n    }\n    \n    return allowLink;\n  }\n  \n  /**\n   * 应用树构建完成钩子\n   */\n  applyTreeBuilt(tree: T[], context: { originalList: T[] }): T[] {\n    let result = tree;\n    \n    for (const plugin of this.getAllPlugins()) {\n      if (plugin.onTreeBuilt) {\n        const pluginResult = plugin.onTreeBuilt(result, context);\n        if (pluginResult) {\n          result = pluginResult;\n        }\n      }\n    }\n    \n    return result;\n  }\n  \n  /**\n   * 清除所有插件\n   */\n  clear(): void {\n    this.plugins.clear();\n  }\n  \n  /**\n   * 获取插件数量\n   */\n  get count(): number {\n    return this.plugins.size;\n  }\n}"],"names":["exports","PluginManager","constructor","this","plugins","Map","register","plugin","has","name","console","warn","set","unregister","pluginName","delete","getPlugin","get","getAllPlugins","Array","from","values","sort","a","b","priority","applyNodeCreated","node","context","result","onNodeCreated","applyNodeLinked","parent","child","allowLink","onNodeLinked","applyTreeBuilt","tree","onTreeBuilt","pluginResult","clear","count","size"],"mappings":"oFAKAA,QAoGCC,cApGD,MAAA,WAAAC,GACUC,KAAAC,QAAsC,IAAIC,GAmGnD,CA9FC,QAAAC,CAASC,GACHJ,KAAKC,QAAQI,IAAID,EAAOE,OAC1BC,QAAQC,KAAK,OAAOJ,EAAOE,kBAE7BN,KAAKC,QAAQQ,IAAIL,EAAOE,KAAMF,EAC/B,CAKD,UAAAM,CAAWC,GACT,OAAOX,KAAKC,QAAQW,OAAOD,EAC5B,CAKD,SAAAE,CAAUF,GACR,OAAOX,KAAKC,QAAQa,IAAIH,EACzB,CAKD,aAAAI,GACE,OAAOC,MAAMC,KAAKjB,KAAKC,QAAQiB,UAC5BC,KAAK,CAACC,EAAGC,KAAOD,EAAEE,UAAY,MAAQD,EAAEC,UAAY,KACxD,CAKD,gBAAAC,CAAiBC,EAASC,GACxB,IAAIC,EAASF,EAEb,IAAK,MAAMpB,KAAUJ,KAAKe,gBACpBX,EAAOuB,eACTvB,EAAOuB,cAAcD,EAAQD,GAIjC,OAAOC,CACR,CAKD,eAAAE,CAAgBC,EAAWC,EAAUL,GACnC,IAAIM,GAAY,EAEhB,IAAK,MAAM3B,KAAUJ,KAAKe,gBACxB,GAAIX,EAAO4B,aAAc,CAEvB,IAAe,IADA5B,EAAO4B,aAAaH,EAAQC,EAAOL,GAC5B,CACpBM,GAAY,EACZ,KACD,CACF,CAGH,OAAOA,CACR,CAKD,cAAAE,CAAeC,EAAWT,GACxB,IAAIC,EAASQ,EAEb,IAAK,MAAM9B,KAAUJ,KAAKe,gBACxB,GAAIX,EAAO+B,YAAa,CACtB,MAAMC,EAAehC,EAAO+B,YAAYT,EAAQD,GAC5CW,IACFV,EAASU,EAEZ,CAGH,OAAOV,CACR,CAKD,KAAAW,GACErC,KAAKC,QAAQoC,OACd,CAKD,SAAIC,GACF,OAAOtC,KAAKC,QAAQsC,IACrB"}